<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Candy Mafia: Waseem Productions</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka+One&family=Bebas+Neue&display=swap');
        :root { --gold: #ffd700; --neon: #ff00ff; }

        body { 
            margin: 0; padding: 0; font-family: 'Fredoka One', cursive; 
            background: #050505; color: white; overflow: hidden; 
            display: flex; flex-direction: column; align-items: center;
            perspective: 1200px; touch-action: none;
        }

        .header { 
            width: 100%; padding: 15px 0; background: rgba(0,0,0,0.9);
            display: flex; justify-content: space-around; align-items: center; 
            z-index: 10; border-bottom: 2px solid var(--gold);
        }

        .board-bg { 
            background: rgba(255, 215, 0, 0.03); padding: 12px; border-radius: 20px; 
            margin: 20px auto; border: 3px solid var(--gold); 
            transform: rotateX(15deg); transform-style: preserve-3d;
        }

        .grid { display: grid; grid-template-columns: repeat(8, 44px); gap: 6px; }

        .slot { 
            width: 44px; height: 44px; background: rgba(255,255,255,0.05); 
            border-radius: 8px; display: flex; align-items: center; justify-content: center;
        }

        .fruit { 
            font-size: 30px; cursor: pointer; transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            user-select: none;
        }

        /* Swiping effect */
        .swapping { z-index: 100; transform: scale(1.2); }

        .dialogue-box {
            position: fixed; bottom: 15%; left: 50%; transform: translateX(-50%) scale(0);
            background: rgba(0,0,0,0.9); color: var(--gold); padding: 10px 20px;
            border: 2px solid var(--gold); border-radius: 8px; font-family: 'Bebas Neue';
            font-size: 24px; z-index: 1000; transition: 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .diag-active { transform: translateX(-50%) scale(1); }

        .fever { animation: shake 0.2s infinite; background: #200 !important; }
        @keyframes shake { 0%, 100% {transform: translate(0,0);} 50% {transform: translate(-3px, 3px);} }

        .btn { background: var(--gold); color: black; border: none; padding: 8px 15px; border-radius: 20px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>
    <div class="header">
        <div class="stat">Cash: <b id="coins">0</b></div>
        <button class="btn" onclick="toggleTheme()">SWAP THEME üï∂Ô∏è</button>
        <div class="stat">Moves: <b id="moves">30</b></div>
    </div>
    
    <div id="diag" class="dialogue-box"></div>

    <div class="board-bg" id="board"><div class="grid" id="grid"></div></div>

<script>
    const gridEl = document.getElementById('grid'), diagEl = document.getElementById('diag'), boardEl = document.getElementById('board');
    const themes = { mafia: ['üî´', 'üï∂Ô∏è', 'üíµ', 'üíé', 'üö¨', 'üöó'], sweet: ['üçé', 'üçä', 'üçã', 'üçá', 'ü´ê', 'ü••'] };
    const dialogues = ["Don ko pakadna mushkil hai!", "Mogambo Khush Hua!", "Risk toh lena padta hai!", "Ye game ab mera hai!"];
    
    let currentTheme = 'mafia', fruits = themes[currentTheme];
    let squares = [], moves = 30, coins = 0;
    let startX, startY, activeId = null;

    function init() {
        gridEl.innerHTML = ''; squares = [];
        for (let i = 0; i < 64; i++) {
            const f = document.createElement('div'); f.className = 'fruit';
            f.innerHTML = fruits[Math.floor(Math.random()*6)];
            f.dataset.id = i;
            // Touch Events for Swiping
            f.ontouchstart = (e) => { activeId = i; startX = e.touches[0].clientX; startY = e.touches[0].clientY; f.classList.add('swapping'); };
            f.ontouchend = (e) => { 
                f.classList.remove('swapping');
                let diffX = e.changedTouches[0].clientX - startX;
                let diffY = e.changedTouches[0].clientY - startY;
                if(Math.abs(diffX) > 30 || Math.abs(diffY) > 30) {
                    let dir = Math.abs(diffX) > Math.abs(diffY) ? (diffX > 0 ? 1 : -1) : (diffY > 0 ? 8 : -8);
                    handleSwipe(i, i + dir);
                }
            };
            const slot = document.createElement('div'); slot.className = 'slot';
            slot.appendChild(f); gridEl.appendChild(slot); squares.push(f);
        }
        check();
    }

    function handleSwipe(id1, id2) {
        if (id2 < 0 || id2 >= 64 || (Math.abs(id1 - id2) === 1 && Math.floor(id1/8) !== Math.floor(id2/8))) return;
        swap(id1, id2);
    }

    function swap(id1, id2) {
        let t = squares[id1].innerHTML;
        squares[id1].innerHTML = squares[id2].innerHTML;
        squares[id2].innerHTML = t;
        
        if(!check()) {
            setTimeout(() => { // Revert if no match
                let t = squares[id1].innerHTML;
                squares[id1].innerHTML = squares[id2].innerHTML;
                squares[id2].innerHTML = t;
            }, 300);
        } else {
            moves--; document.getElementById('moves').innerText = moves;
        }
    }

    function check() {
        let matches = new Set();
        for(let i=0; i<64; i++) {
            let r = Math.floor(i/8), c = i%8;
            if(c < 6 && squares[i].innerHTML === squares[i+1].innerHTML && squares[i].innerHTML === squares[i+2].innerHTML) { matches.add(i); matches.add(i+1); matches.add(i+2); }
            if(r < 6 && squares[i].innerHTML === squares[i+8].innerHTML && squares[i].innerHTML === squares[i+16].innerHTML) { matches.add(i); matches.add(i+8); matches.add(i+16); }
        }
        if(matches.size > 0) {
            if(matches.size >= 5) {
                boardEl.classList.add('fever');
                diagEl.innerText = dialogues[Math.floor(Math.random()*dialogues.length)];
                diagEl.classList.add('diag-active');
                setTimeout(() => { boardEl.classList.remove('fever'); diagEl.classList.remove('diag-active'); }, 1500);
            }
            matches.forEach(id => { squares[id].style.transform = "scale(0)"; squares[id].style.opacity = "0"; });
            coins += matches.size * 10; document.getElementById('coins').innerText = coins;
            setTimeout(fill, 300); return true;
        }
        return false;
    }

    function fill() {
        squares.forEach(s => { 
            if(s.style.opacity === "0") { 
                s.innerHTML = fruits[Math.floor(Math.random()*6)]; 
                s.style.transform = "scale(1)"; s.style.opacity = "1"; 
            } 
        });
        setTimeout(check, 300); // For chain reactions
    }

    function toggleTheme() { currentTheme = currentTheme === 'mafia' ? 'sweet' : 'mafia'; fruits = themes[currentTheme]; init(); }
    window.onload = init;
</script>
</body>
</html>
