<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Candy Mafia: Executive Edition - Waseem Productions</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka+One&family=Bebas+Neue&display=swap');
        :root { --gold: #ffd700; --neon: #00f2ff; --pink: #ff0055; --glow: rgba(255, 215, 0, 0.3); }

        body { 
            margin: 0; padding: 0; font-family: 'Fredoka One', cursive; 
            background: radial-gradient(circle at center, #222, #000); color: white; 
            overflow: hidden; display: flex; flex-direction: column; align-items: center; 
            touch-action: none;
        }

        /* Header Visuals */
        .header { 
            width: 100%; padding: 15px 0; background: rgba(0,0,0,0.9);
            display: flex; justify-content: space-around; align-items: center; 
            border-bottom: 3px solid var(--gold); box-shadow: 0 5px 30px var(--glow);
            z-index: 10;
        }
        .stat b { font-size: 20px; color: var(--gold); text-shadow: 0 0 5px var(--gold); }

        /* Board Styling */
        .board-bg { 
            background: rgba(0,0,0,0.6); padding: 12px; border-radius: 25px; 
            border: 4px solid var(--gold); position: relative;
            width: 94vw; max-width: 380px; height: 94vw; max-height: 380px;
            box-sizing: border-box; margin-top: 30px;
            box-shadow: 0 0 50px rgba(0,0,0,1), inset 0 0 20px var(--glow);
        }

        .grid { 
            display: grid; grid-template-columns: repeat(8, 1fr); 
            gap: 6px; height: 100%; width: 100%;
        }

        .slot { 
            position: relative; background: rgba(255,255,255,0.02); 
            border-radius: 10px; border: 1px solid rgba(255,255,255,0.05);
        }

        .fruit { 
            position: absolute; width: 100%; height: 100%;
            display: flex; align-items: center; justify-content: center;
            font-size: 7.5vw; cursor: pointer; 
            /* EKDOM SLOW GRAVITY (1.2s) */
            transition: top 1.2s cubic-bezier(0.4, 0, 0.2, 1), transform 0.2s, opacity 0.4s;
            user-select: none; z-index: 5;
            filter: drop-shadow(0 5px 8px rgba(0,0,0,0.8));
        }
        
        @media (min-width: 500px) { .fruit { font-size: 36px; } }

        /* Enhanced Power VFX */
        .rocket { border: 2px solid var(--neon); border-radius: 50%; box-shadow: 0 0 20px var(--neon), inset 0 0 10px var(--neon); }
        .bomb { border: 2px solid var(--pink); border-radius: 50%; box-shadow: 0 0 25px var(--pink); animation: pulse 0.7s infinite alternate; }
        
        @keyframes pulse { from { transform: scale(1); filter: brightness(1); } to { transform: scale(1.15); filter: brightness(1.6); } }

        .vfx {
            position: fixed; pointer-events: none; color: var(--gold);
            font-family: 'Bebas Neue'; font-size: 40px; text-shadow: 0 0 20px #000;
            animation: cinematicFloat 1.2s forwards; z-index: 1000;
        }
        @keyframes cinematicFloat { 0% { opacity: 0; transform: translate(-50%, 20px) scale(0.5); } 20% { opacity: 1; transform: translate(-50%, 0) scale(1.2); } 100% { opacity: 0; transform: translate(-50%, -150px) scale(2); } }
        
        .mute-btn { position: absolute; top: 80px; right: 20px; background: var(--gold); border: none; border-radius: 50%; width: 50px; height: 50px; cursor: pointer; font-size: 24px; z-index: 100; box-shadow: 0 5px 15px rgba(0,0,0,0.5); transition: 0.2s; }
        .mute-btn:active { transform: scale(0.9); }
    </style>
</head>
<body>

    <div class="header">
        <div class="stat">Cash: <b id="coins">0</b></div>
        <div style="font-family: 'Bebas Neue'; color: var(--gold); font-size: 28px; letter-spacing: 3px; text-shadow: 0 0 15px var(--gold);">MAFIA BOSS</div>
        <div class="stat">Moves: <b id="moves">30</b></div>
    </div>

    <button class="mute-btn" onclick="toggleMute()" id="muteIcon">üîä</button>

    <div class="board-bg">
        <div class="grid" id="grid"></div>
    </div>

<script>
    const gridEl = document.getElementById('grid'), coinsEl = document.getElementById('coins'), movesEl = document.getElementById('moves');
    const items = ['üî´', 'üï∂Ô∏è', 'üíµ', 'üíé', 'üö¨', 'üöó'];
    const quotes = ["AMAZING!", "UNSTOPPABLE!", "LEGENDARY!", "DON STYLE!", "POWERFUL!"];
    
    // Naya Cinematic Background Music
    const matchSound = new Audio('https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3');
    const powerSound = new Audio('https://assets.mixkit.co/active_storage/sfx/1654/1654-preview.mp3');
    const bgMusic = new Audio('https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3');
    bgMusic.loop = true; bgMusic.volume = 0.3;

    let squares = [], moves = 30, coins = 0, isMuted = false, sX, sY, isProcessing = false, comboCount = 0;

    function toggleMute() {
        isMuted = !isMuted;
        bgMusic.muted = isMuted; matchSound.muted = isMuted; powerSound.muted = isMuted;
        document.getElementById('muteIcon').innerText = isMuted ? "üîá" : "üîä";
    }

    function init() {
        gridEl.innerHTML = ''; squares = [];
        for (let i = 0; i < 64; i++) {
            const slot = document.createElement('div'); slot.className = 'slot';
            const f = document.createElement('div'); f.className = 'fruit';
            f.innerHTML = items[Math.floor(Math.random()*6)];
            f.dataset.id = i;
            
            f.ontouchstart = (e) => { 
                if(!isProcessing) {
                    sX = e.touches[0].clientX; sY = e.touches[0].clientY; 
                    if(bgMusic.paused) bgMusic.play().catch(() => {});
                }
            };
            f.ontouchend = (e) => { 
                if(isProcessing) return;
                let dX = e.changedTouches[0].clientX - sX, dY = e.changedTouches[0].clientY - sY;
                if(Math.abs(dX) > 25 || Math.abs(dY) > 25) {
                    let dir = Math.abs(dX) > Math.abs(dY) ? (dX > 0 ? 1 : -1) : (dY > 0 ? 8 : -8);
                    move(i, i + dir);
                }
            };

            slot.appendChild(f); gridEl.appendChild(slot); squares.push(f);
        }
        setTimeout(check, 500);
    }

    function move(id1, id2) {
        if (isProcessing || id2 < 0 || id2 >= 64 || (Math.abs(id1 - id2) === 1 && Math.floor(id1/8) !== Math.floor(id2/8))) return;
        
        isProcessing = true;
        comboCount = 0; // Reset combo on new move
        let t = squares[id1].innerHTML;
        let c1 = squares[id1].className, c2 = squares[id2].className;
        
        squares[id1].innerHTML = squares[id2].innerHTML; squares[id1].className = c2;
        squares[id2].innerHTML = t; squares[id2].className = c1;

        if(!check(id2)) {
            setTimeout(() => { 
                let t = squares[id1].innerHTML; 
                squares[id1].innerHTML = squares[id2].innerHTML; squares[id1].className = c1;
                squares[id2].innerHTML = t; squares[id2].className = c2;
                isProcessing = false;
            }, 400);
        } else {
            moves--; movesEl.innerText = moves;
            if(!isMuted) matchSound.play().catch(() => {});
            setTimeout(() => { isProcessing = false; }, 1200);
        }
    }

    function check(lastId) {
        let matches = new Set();
        for(let r=0; r<8; r++) {
            for(let c=0; c<6; c++) {
                let i = r*8+c;
                if(squares[i].innerHTML === squares[i+1].innerHTML && squares[i].innerHTML === squares[i+2].innerHTML) {
                    matches.add(i); matches.add(i+1); matches.add(i+2);
                }
            }
        }
        for(let c=0; c<8; c++) {
            for(let r=0; r<6; r++) {
                let i = r*8+c;
                if(squares[i].innerHTML === squares[i+8].innerHTML && squares[i].innerHTML === squares[i+16].innerHTML) {
                    matches.add(i); matches.add(i+8); matches.add(i+16);
                }
            }
        }

        if(matches.size > 0) {
            comboCount++;
            let triggeredPower = false;
            
            matches.forEach(id => {
                if(squares[id].classList.contains('rocket')) { clearRow(Math.floor(id/8)); triggeredPower = true; }
                if(squares[id].classList.contains('bomb')) { clearArea(id); triggeredPower = true; }
            });

            if(lastId != null && matches.has(lastId)) {
                if(matches.size == 4) { squares[lastId].className = 'fruit rocket'; triggeredPower = true; }
                else if(matches.size >= 5) { squares[lastId].className = 'fruit bomb'; triggeredPower = true; }
            }

            if(triggeredPower || comboCount > 1) {
                showVFX(comboCount > 2 ? quotes[comboCount % quotes.length] : null); 
                if(!isMuted) powerSound.play().catch(() => {});
            }

            matches.forEach(id => { 
                if(squares[id].className === 'fruit') {
                    squares[id].style.transform = "scale(0)";
                    squares[id].dataset.empty = "true";
                }
            });

            coins += matches.size * 10 * comboCount; coinsEl.innerText = coins;
            setTimeout(dropAndFill, 600); return true;
        }
        return false;
    }

    function clearRow(row) {
        for(let i = row*8; i < (row*8)+8; i++) {
            squares[i].style.transform = "scale(0)";
            squares[i].dataset.empty = "true";
        }
    }

    function clearArea(id) {
        let r = Math.floor(id/8), c = id%8;
        for(let i=r-1; i<=r+1; i++) {
            for(let j=c-1; j<=c+1; j++) {
                if(i>=0 && i<8 && j>=0 && j<8) {
                    let idx = i*8+j;
                    squares[idx].style.transform = "scale(0)";
                    squares[idx].dataset.empty = "true";
                }
            }
        }
    }

    function dropAndFill() {
        for (let c = 0; c < 8; c++) {
            let emptySlots = 0;
            for (let r = 7; r >= 0; r--) {
                let i = r * 8 + c;
                if (squares[i].dataset.empty === "true") {
                    emptySlots++;
                } else if (emptySlots > 0) {
                    let target = (r + emptySlots) * 8 + c;
                    squares[target].innerHTML = squares[i].innerHTML;
                    squares[target].className = squares[i].className;
                    squares[target].dataset.empty = "false";
                    squares[target].style.transform = "scale(1)";
                    
                    squares[i].dataset.empty = "true";
                    squares[i].style.transform = "scale(0)";
                }
            }
            for (let r = 0; r < emptySlots; r++) {
                let i = r * 8 + c;
                squares[i].innerHTML = items[Math.floor(Math.random()*6)];
                squares[i].className = 'fruit';
                squares[i].dataset.empty = "false";
                squares[i].style.transform = "scale(1)";
                squares[i].style.top = "-400px"; // Start from top for falling effect
                setTimeout(() => { squares[i].style.top = "0"; }, 50);
            }
        }
        setTimeout(check, 1300); // Wait for slow fall
    }

    function showVFX(customText) {
        const v = document.createElement('div'); v.className = 'vfx';
        v.innerText = customText || quotes[Math.floor(Math.random()*quotes.length)];
        v.style.left = "50%"; v.style.top = "45%";
        document.body.appendChild(v);
        setTimeout(() => v.remove(), 1200);
    }

    window.onload = init;
</script>
</body>
</html>
