<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Fruit Farm Grand Frame | BZ247 Studios</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka:wght@600;700&display=swap');
        * { user-select: none; -webkit-tap-highlight-color: transparent; box-sizing: border-box; margin: 0; padding: 0; }
        
        body { 
            background: linear-gradient(180deg, #4facfe 0%, #00f2fe 100%);
            color: #fff; font-family: 'Fredoka', sans-serif; height: 100vh; 
            display: flex; flex-direction: column; align-items: center; justify-content: center; overflow: hidden; 
        }

        /* LIVING SKY BACKGROUND */
        .clouds { position: fixed; top: 0; left: 0; width: 200%; height: 100%; background: url('https://www.transparenttextures.com/patterns/clouds.png'); opacity: 0.3; animation: drift 60s linear infinite; z-index: -1; }
        @keyframes drift { from { transform: translateX(0); } to { transform: translateX(-50%); } }

        /* HUD */
        .header { width: 95%; max-width: 440px; display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 20px; z-index: 10; }
        .stat-box { background: rgba(255, 255, 255, 0.25); border: 2.5px solid rgba(255, 255, 255, 0.6); padding: 12px; border-radius: 25px; text-align: center; backdrop-filter: blur(15px); box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .stat-box b { font-size: 22px; display: block; color: #fff; text-shadow: 0 2px 4px rgba(0,0,0,0.1); }

        /* --- THE GRAND FRAME UPDATE --- */
        #board-wrap { 
            background: rgba(255, 255, 255, 0.25); 
            padding: 18px; 
            border-radius: 45px; /* Bigger rounded corners */
            border: 6px solid rgba(255, 255, 255, 0.5); 
            box-shadow: 0 35px 70px rgba(0,0,0,0.15), inset 0 0 25px rgba(255,255,255,0.3);
            backdrop-filter: blur(12px);
            overflow: hidden;
            display: flex; justify-content: center; align-items: center;
        }

        #board { 
            display: grid; 
            grid-template-columns: repeat(8, 1fr); 
            grid-gap: 8px; 
            width: 90vw; height: 90vw; /* Increased width on mobile */
            max-width: 400px; max-height: 400px; /* Increased Max Size */
        }

        .cell { 
            background: rgba(255, 255, 255, 0.12); 
            border-radius: 18px; 
            position: relative; 
            display: flex; align-items: center; justify-content: center;
        }

        /* FRUITS SIZE INCREASE */
        .candy { 
            font-size: 40px; /* Bigger Fruits */
            position: relative; 
            transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.2));
            z-index: 2;
        }

        .cell.selected .candy { 
            transform: scale(1.15); /* More prominent selection */
        }

        .c-0::before { content: 'üçì'; } .c-1::before { content: 'üçä'; }
        .c-2::before { content: 'üçá'; } .c-3::before { content: 'üçè'; }

        /* OVERLAY */
        #overlay { position: fixed; inset: 0; background: linear-gradient(135deg, #a8e063, #56ab2f); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 1000; }
        .btn { background: linear-gradient(to bottom, #ffa502, #ff6348); color: #fff; padding: 25px 100px; border-radius: 70px; border: 5px solid #fff; font-weight: 900; font-size: 26px; cursor: pointer; box-shadow: 0 15px 40px rgba(0,0,0,0.2); }
    </style>
</head>
<body>
    <div class="clouds"></div>
    <div id="overlay">
        <h1 style="color:#fff; font-size: 48px; text-shadow: 0 4px 8px rgba(0,0,0,0.2);">FRUIT FARM</h1>
        <p style="color:#fff; margin: 15px 0 40px 0; letter-spacing: 2px; font-weight: 600;">GRAND FRAME V25</p>
        <button class="btn" onclick="startGame()">PLAY GRAND ‚ñ∂</button>
    </div>

    <div class="header">
        <div class="stat-box"><small>MOVES</small><b id="mDisplay">25</b></div>
        <div class="stat-box"><small>TARGET</small><b id="tDisplay">4500</b></div>
        <div class="stat-box"><small>SCORE</small><b id="sDisplay">0</b></div>
    </div>

    <div id="board-wrap"><div id="board"></div></div>

<script>
    // CORE GAME LOGIC
    const board = document.getElementById('board'), sDisplay = document.getElementById('sDisplay'), 
          mDisplay = document.getElementById('mDisplay'), tDisplay = document.getElementById('tDisplay');
    const width = 8, candyColors = 4;
    let grid = [], score = 0, moves = 25, target = 4500, isProcessing = false, selectedCell = null;

    function startGame() { document.getElementById('overlay').style.display = 'none'; createBoard(); updateHUD(); }

    function createBoard() {
        grid = []; board.innerHTML = '';
        for (let i = 0; i < width * width; i++) {
            const cell = document.createElement('div');
            cell.className = 'cell'; cell.setAttribute('data-id', i);
            cell.onclick = () => handleCellClick(cell);
            cell.appendChild(createFruit(Math.floor(Math.random() * candyColors)));
            board.appendChild(cell); grid.push(cell);
        }
        checkMatches();
    }

    function createFruit(color) {
        const c = document.createElement('div');
        c.className = `candy c-${color}`; c.setAttribute('data-color', color);
        return c;
    }

    function handleCellClick(cell) {
        if (isProcessing) return;
        if (!selectedCell) { selectedCell = cell; cell.classList.add('selected'); }
        else {
            const id1 = parseInt(selectedCell.getAttribute('data-id')), id2 = parseInt(cell.getAttribute('data-id'));
            if ([id1-1, id1+1, id1-width, id1+width].includes(id2)) {
                const c1 = selectedCell.firstChild, c2 = cell.firstChild;
                selectedCell.appendChild(c2); cell.appendChild(c1);
                moves--; updateHUD(); setTimeout(checkMatches, 300);
            }
            selectedCell.classList.remove('selected'); selectedCell = null;
        }
    }

    function checkMatches() {
        isProcessing = true;
        let matched = new Set();
        for (let r = 0; r < width; r++) {
            for (let c = 0; c < width - 2; c++) {
                let i = r * width + c;
                let clr = grid[i].firstChild?.getAttribute('data-color');
                if (clr && grid[i+1].firstChild?.getAttribute('data-color') === clr && grid[i+2].firstChild?.getAttribute('data-color') === clr) {
                    matched.add(i); matched.add(i+1); matched.add(i+2);
                }
            }
        }
        for (let c = 0; c < width; c++) {
            for (let r = 0; r < width - 2; r++) {
                let i = r * width + c;
                let clr = grid[i].firstChild?.getAttribute('data-color');
                if (clr && grid[i+width].firstChild?.getAttribute('data-color') === clr && grid[i+width*2].firstChild?.getAttribute('data-color') === clr) {
                    matched.add(i); matched.add(i+width); matched.add(i+width*2);
                }
            }
        }

        if (matched.size > 0) {
            matched.forEach(i => { if(grid[i].firstChild) grid[i].firstChild.style.transform = 'scale(0)'; });
            score += matched.size * 30; updateHUD();
            setTimeout(() => {
                matched.forEach(i => { if(grid[i].firstChild) grid[i].removeChild(grid[i].firstChild); });
                applyGravity();
            }, 300);
        } else { isProcessing = false; }
    }

    function applyGravity() {
        for (let c = 0; c < width; c++) {
            let empty = 0;
            for (let r = width - 1; r >= 0; r--) {
                let i = r * width + c;
                if (!grid[i].firstChild) empty++;
                else if (empty > 0) grid[i + (empty * width)].appendChild(grid[i].firstChild);
            }
            for (let i = 0; i < empty; i++) {
                const n = createFruit(Math.floor(Math.random() * candyColors));
                n.style.animation = "drop 0.4s ease-in";
                grid[i * width + c].appendChild(n);
            }
        }
        setTimeout(checkMatches, 500);
    }

    function updateHUD() {
        sDisplay.innerText = score; mDisplay.innerText = moves; tDisplay.innerText = target;
        if (score >= target) { target += 3000; moves += 10; }
        if (moves <= 0) { alert("HEIST OVER!"); location.reload(); }
    }
</script>
</body>
</html>
