<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Candy Mafia: Colorful Edition</title>
    <style>
        /* Modern Fonts */
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700&family=Bebas+Neue&family=Montserrat:wght@800&display=swap');
        
        :root { 
            --gold: #FFD700; 
            --pink: #FF00FF;
            --blue: #00FFFF;
        }

        body { 
            margin: 0; padding: 0; font-family: 'Orbitron', sans-serif; 
            /* COLORFUL Background: Casino Night Vibe */
            background: linear-gradient(135deg, #2b1055, #7597de);
            color: white; overflow: hidden; display: flex; flex-direction: column; align-items: center; 
            height: 100vh; touch-action: none;
        }

        /* Glass Header */
        .header { 
            width: 92%; max-width: 420px; margin: 15px 0; padding: 10px 15px;
            background: rgba(0, 0, 0, 0.3); backdrop-filter: blur(10px);
            display: flex; justify-content: space-between; align-items: center; 
            border: 2px solid rgba(255,215,0,0.3); border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
        }

        .stat { text-align: center; }
        .stat b { font-size: 22px; color: var(--gold); display: block; text-shadow: 0 0 10px var(--gold); }
        .stat span { font-size: 10px; text-transform: uppercase; letter-spacing: 1px; font-weight: bold;}

        .game-title { 
            font-family: 'Bebas Neue'; color: white; font-size: 32px; 
            letter-spacing: 2px;
            text-shadow: 2px 2px 0px var(--pink), -2px -2px 0px var(--blue);
        }

        /* Colorful Board Container */
        .board-bg { 
            background: rgba(20, 0, 40, 0.6); padding: 8px; border-radius: 20px; 
            border: 3px solid var(--gold);
            width: 94vw; max-width: 390px; 
            height: 94vw; max-height: 390px;
            box-sizing: border-box; position: relative;
            /* Colorful Glow */
            box-shadow: 0 0 30px var(--pink), inset 0 0 20px rgba(0,0,255,0.3);
        }

        .grid { 
            display: grid; grid-template-columns: repeat(8, 1fr); 
            grid-template-rows: repeat(8, 1fr);
            gap: 4px; height: 100%; width: 100%;
        }

        .slot { 
            background: rgba(255,255,255,0.05); 
            border-radius: 8px; position: relative; 
            display: flex; align-items: center; justify-content: center;
            border: 1px solid rgba(255,255,255,0.1);
        }

        /* Smooth Icons */
        .fruit { 
            width: 100%; height: 100%; display: flex; align-items: center; justify-content: center;
            font-size: 8vw; cursor: pointer; user-select: none; z-index: 5;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            filter: drop-shadow(0 2px 3px rgba(0,0,0,0.5));
        }
        @media (min-width: 400px) { .fruit { font-size: 34px; } }
        .pop { transform: scale(0) rotate(180deg); opacity: 0; }

        /* --- GAME OVER SCREEN --- */
        .game-over-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); z-index: 100;
            display: none; /* Hidden by default */
            justify-content: center; align-items: center; flex-direction: column;
            backdrop-filter: blur(5px);
        }
        .go-box {
            background: linear-gradient(45deg, var(--bule), var(--pink));
            background: rgba(40, 10, 60, 0.9);
            border: 4px solid var(--gold);
            padding: 30px; border-radius: 20px; text-align: center;
            box-shadow: 0 0 50px var(--gold);
            animation: popIn 0.5s ease-out;
        }
        @keyframes popIn { from {transform: scale(0.5); opacity:0;} to {transform: scale(1); opacity:1;} }
        .go-box h2 { font-family: 'Bebas Neue'; font-size: 50px; margin: 0; color: var(--gold); }
        .go-box p { font-family: 'Montserrat', sans-serif; font-size: 18px; margin: 10px 0; }
        .go-btn {
            background: linear-gradient(to right, var(--pink), var(--gold));
            border: none; padding: 10px 30px; color: black; font-weight: bold;
            font-family: 'Orbitron'; font-size: 18px; border-radius: 30px;
            cursor: pointer; margin-top: 20px; box-shadow: 0 5px 15px rgba(255, 215, 0, 0.4);
        }
        .go-btn:active { transform: scale(0.95); }

        /* Mute Button */
        .mute-btn { 
            position: fixed; bottom: 20px; right: 20px;
            background: var(--gold); border: none; 
            border-radius: 50%; width: 50px; height: 50px; 
            font-size: 24px; cursor: pointer; box-shadow: 0 5px 15px rgba(0,0,0,0.5);
            z-index: 50;
        }
    </style>
</head>
<body>

    <div class="header">
        <div class="stat"><span>Cash</span><b id="coins">0</b></div>
        <div class="game-title">MAFIA BOSS</div>
        <div class="stat"><span>Moves</span><b id="moves">20</b></div>
    </div>

    <div class="board-bg">
        <div class="grid" id="grid"></div>
    </div>

    <div id="gameOver" class="game-over-overlay">
        <div class="go-box">
            <h2>GAME OVER</h2>
            <p>YOUR LOOT: <b style="color: var(--gold);">$<span id="finalScore">0</span></b></p>
            <p>BEST HEIST: <b style="color: var(--pink);">$<span id="bestScore">0</span></b></p>
            <button class="go-btn" onclick="restartGame()">PLAY AGAIN</button>
        </div>
    </div>

    <button class="mute-btn" onclick="toggleMute()" id="muteIcon">ðŸ”Š</button>

<script>
    const gridEl = document.getElementById('grid'), coinsEl = document.getElementById('coins'), movesEl = document.getElementById('moves');
    const gameOverScreen = document.getElementById('gameOver');
    const items = ['ðŸ’Ž', 'ðŸš—', 'ðŸ’µ', 'ðŸ•¶ï¸', 'ðŸ”«', 'ðŸ’°'];
    
    // MUSIC & SFX (Using reliable placeholder sounds)
    const matchSound = new Audio('https://assets.mixkit.co/active_storage/sfx/2018/2018-preview.mp3'); matchSound.volume = 0.5;
    const gameOverSFX = new Audio('https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.mp3');
    // Colorful Vibe BG Music
    const bgMusic = new Audio('https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3'); 
    bgMusic.loop = true; bgMusic.volume = 0.3;

    let squares = [], moves = 20, coins = 0, isMuted = false, sX, sY, isProcessing = false;
    // HIGH SCORE LOAD
    let highScore = localStorage.getItem('mafiaHighScore') || 0;

    function toggleMute() {
        isMuted = !isMuted;
        bgMusic.muted = isMuted; matchSound.muted = isMuted; gameOverSFX.muted = isMuted;
        document.getElementById('muteIcon').innerText = isMuted ? "ðŸ”‡" : "ðŸ”Š";
        if(!isMuted && moves > 0) bgMusic.play().catch(()=>{});
    }

    function init() {
        gridEl.innerHTML = ''; squares = [];
        for (let i = 0; i < 64; i++) {
            const slot = document.createElement('div'); slot.className = 'slot';
            const f = document.createElement('div'); f.className = 'fruit';
            f.innerHTML = items[Math.floor(Math.random()*items.length)];
            
            f.ontouchstart = (e) => { 
                if(!isProcessing && moves > 0) {
                    sX = e.touches[0].clientX; sY = e.touches[0].clientY; 
                    if(bgMusic.paused && !isMuted) bgMusic.play().catch(() => {});
                }
            };
            f.ontouchend = (e) => { 
                if(isProcessing || moves <= 0) return;
                let dX = e.changedTouches[0].clientX - sX, dY = e.changedTouches[0].clientY - sY;
                if(Math.abs(dX) > 25 || Math.abs(dY) > 25) {
                    let dir = Math.abs(dX) > Math.abs(dY) ? (dX > 0 ? 1 : -1) : (dY > 0 ? 8 : -8);
                    handleMove(i, i + dir);
                }
            };
            slot.appendChild(f); gridEl.appendChild(slot); squares.push(f);
        }
        setTimeout(checkMatches, 500);
    }

    async function handleMove(id1, id2) {
        if (id2 < 0 || id2 >= 64 || (Math.abs(id1-id2)===1 && Math.floor(id1/8)!==Math.floor(id2/8))) return;
        isProcessing = true;
        swapIcons(id1, id2);
        await new Promise(r => setTimeout(r, 350));

        if(!checkMatches()) {
            swapIcons(id1, id2); // Swap back
            await new Promise(r => setTimeout(r, 350));
            isProcessing = false;
        } else {
            // Move successful
            moves--; movesEl.innerText = moves;
            if(!isMuted) matchSound.play().catch(()=>{});
            if(moves === 0) setTimeout(endGame, 1500);
        }
    }

    function swapIcons(id1, id2) {
        let temp = squares[id1].innerHTML;
        squares[id1].innerHTML = squares[id2].innerHTML;
        squares[id2].innerHTML = temp;
    }

    function checkMatches() {
        let matches = new Set();
        // Rows & Columns Check
        for(let r=0; r<8; r++) { for(let c=0; c<6; c++) { let i=r*8+c; if(squares[i].innerHTML===squares[i+1].innerHTML && squares[i].innerHTML===squares[i+2].innerHTML) { matches.add(i); matches.add(i+1); matches.add(i+2); }}}
        for(let c=0; c<8; c++) { for(let r=0; r<6; r++) { let i=r*8+c; if(squares[i].innerHTML===squares[i+8].innerHTML && squares[i].innerHTML===squares[i+16].innerHTML) { matches.add(i); matches.add(i+8); matches.add(i+16); }}}

        if(matches.size > 0) {
            matches.forEach(id => squares[id].classList.add('pop'));
            coins += matches.size * 10; coinsEl.innerText = coins;
            setTimeout(fillBoard, 400);
            return true;
        }
        isProcessing = false;
        return false;
    }

    function fillBoard() {
        for (let i = 0; i < 64; i++) {
            if (squares[i].classList.contains('pop')) {
                squares[i].innerHTML = items[Math.floor(Math.random()*items.length)];
                squares[i].classList.remove('pop');
                squares[i].style.transform = 'scale(0)';
                setTimeout(() => { squares[i].style.transform = 'scale(1)'; }, i*5);
            }
        }
        setTimeout(checkMatches, 500);
    }

    function endGame() {
        bgMusic.pause();
        if(!isMuted) gameOverSFX.play().catch(()=>{});
        
        // HIGH SCORE LOGIC
        if(coins > highScore) {
            highScore = coins;
            localStorage.setItem('mafiaHighScore', highScore);
        }
        
        document.getElementById('finalScore').innerText = coins;
        document.getElementById('bestScore').innerText = highScore;
        gameOverScreen.style.display = 'flex';
    }

    function restartGame() {
        location.reload();
    }

    window.onload = init;
</script>
</body>
</html>
