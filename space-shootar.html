<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Space Vanguard: Real Combat | BZ247</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@900&display=swap');
        :root { --neon: #00ff88; --pink: #ff0055; --cyan: #00d4ff; --gold: #ffd700; --red: #ff3e3e; }
        
        * { user-select: none; -webkit-user-select: none; touch-action: none; -webkit-tap-highlight-color: transparent; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #000; font-family: 'Orbitron', sans-serif; color: white; }
        
        #gameCanvas { display: block; background: #000; }
        
        /* ELITE HUD */
        .hud { position: absolute; top: 15px; width: 100%; display: flex; justify-content: space-around; pointer-events: none; z-index: 10; }
        .stat { background: rgba(0,0,0,0.85); border: 2px solid var(--cyan); padding: 8px 15px; border-radius: 12px; text-align: center; box-shadow: 0 0 20px rgba(0, 212, 255, 0.2); backdrop-filter: blur(5px); }
        .stat b { font-size: 18px; text-shadow: 0 0 10px var(--cyan); }

        /* DRAGON HEALTH BAR */
        #bossHealthWrap { position: absolute; top: 95px; width: 80%; left: 10%; display: none; z-index: 10; text-align: center; }
        #bossBar { width: 100%; height: 12px; background: #111; border: 2px solid var(--pink); border-radius: 6px; overflow: hidden; box-shadow: 0 0 15px var(--pink); }
        #bossFill { height: 100%; background: linear-gradient(to right, #660000, var(--pink)); width: 100%; transition: 0.2s; }

        /* UI BUTTONS */
        #pauseBtn { position: absolute; top: 15px; right: 15px; width: 45px; height: 45px; background: rgba(255,255,255,0.1); border: 2px solid white; border-radius: 50%; color: white; z-index: 100; display: flex; align-items: center; justify-content: center; font-size: 20px; box-shadow: 0 0 10px rgba(255,255,255,0.2); }

        #overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.98); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 1000; text-align: center; }
        .start-btn { background: var(--cyan); color: #000; padding: 20px 55px; border-radius: 60px; font-weight: 900; font-size: 20px; border: none; cursor: pointer; box-shadow: 0 0 40px var(--cyan); margin-top: 25px; transition: 0.3s; }
        .start-btn:active { transform: scale(0.9); }

        /* DAMAGE FLASH EFFECT */
        .shake { animation: shake 0.2s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake { 10%, 90% { transform: translate3d(-2px, 0, 0); } 20%, 80% { transform: translate3d(4px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-4px, 0, 0); } 40%, 60% { transform: translate3d(4px, 0, 0); } }
        .damage-flash { position: fixed; inset: 0; background: rgba(255,0,0,0.3); z-index: 999; pointer-events: none; animation: flash 0.1s linear 2; display: none; }
        @keyframes flash { from { opacity: 1; } to { opacity: 0; } }
    </style>
</head>
<body onload="init()">

    <div id="damageOverlay" class="damage-flash"></div>

    <div id="overlay">
        <h1 style="color:var(--cyan); margin:0; letter-spacing:5px;">JET VANGUARD</h1>
        <p style="color:#555; font-size:10px; letter-spacing:4px;">REALISTIC COMBAT SYSTEM</p>
        <button class="start-btn" onclick="startMission()">LAUNCH MISSION ▶</button>
    </div>

    <button id="pauseBtn" onclick="togglePause()">⏸</button>

    <div class="hud">
        <div class="stat"><span>SCORE</span><br><b id="s">0</b></div>
        <div class="stat"><span>STAGE</span><br><b id="lv">1</b></div>
        <div class="stat"><span>HP</span><br><b id="h">100</b></div>
    </div>

    <div id="bossHealthWrap">
        <div id="bossBar"><div id="bossFill"></div></div>
        <small style="color:var(--pink); letter-spacing:3px; font-weight:bold;">DRAGON MOTHERSHIP</small>
    </div>

    <canvas id="gameCanvas"></canvas>

<script>
    const canvas = document.getElementById('gameCanvas'), ctx = canvas.getContext('2d');
    
    // REALISTIC ASSETS
    let shipImg = new Image(), enemyImg = new Image(), bossImg = new Image();
    shipImg.src = 'https://cdn-icons-png.flaticon.com/512/3214/3214589.png'; // More Realistic Jet
    enemyImg.src = 'https://cdn-icons-png.flaticon.com/512/3214/3214643.png'; // Realistic Alien Ship
    bossImg.src = 'https://cdn-icons-png.flaticon.com/512/3063/3063548.png'; // Dragon Boss

    let score = 0, stage = 1, health = 100, gameActive = false, isPaused = false;
    let dragonHP = 1000, dragonActive = false, shooting = false;
    let player = { x: 0, y: 0, w: 65, h: 65, tx: 0, ty: 0, alive: true };
    let bullets = [], enemyBullets = [], enemies = [], particles = [], stars = [];

    let audioCtx;
    function initAudio() { if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)(); }
    function playSound(f, type, d, v=0.04) {
        if(!audioCtx || isPaused) return;
        let o = audioCtx.createOscillator(), g = audioCtx.createGain();
        o.type = type; o.frequency.setValueAtTime(f, audioCtx.currentTime);
        g.gain.setValueAtTime(v, audioCtx.currentTime);
        o.connect(g); g.connect(audioCtx.destination);
        o.start(); o.stop(audioCtx.currentTime + d);
    }

    function init() {
        canvas.width = window.innerWidth; canvas.height = window.innerHeight;
        for(let i=0; i<100; i++) stars.push({ x: Math.random()*canvas.width, y: Math.random()*canvas.height, s: Math.random()*3+1, o: Math.random() });
    }

    function startMission() {
        document.getElementById('overlay').style.display = 'none';
        initAudio(); gameActive = true;
        player.tx = player.x = canvas.width/2 - 35;
        player.ty = player.y = canvas.height - 180;
        loop();
    }

    function togglePause() { isPaused = !isPaused; document.getElementById('pauseBtn').innerText = isPaused ? "▶" : "⏸"; }

    // TOUCH CONTROL
    canvas.addEventListener('touchstart', (e) => { shooting = true; updateT(e); });
    canvas.addEventListener('touchmove', updateT);
    canvas.addEventListener('touchend', () => shooting = false);
    function updateT(e) { if(!gameActive || isPaused || !player.alive) return; player.tx = e.touches[0].clientX - 35; player.ty = e.touches[0].clientY - 100; }

    // GAME CYCLES
    setInterval(() => { if(shooting && gameActive && !isPaused && player.alive) fire(); }, 140);
    setInterval(() => { if(gameActive && !dragonActive && !isPaused && player.alive) spawn(); }, 1200);
    setInterval(() => { if(dragonActive && !isPaused) bossFire(); }, 1500);
    setInterval(() => { if(gameActive && player.alive && !isPaused) enemyFire(); }, 1800);

    function fire() {
        bullets.push({ x: player.x + 10, y: player.y, w: 5, h: 22 });
        bullets.push({ x: player.x + 50, y: player.y, w: 5, h: 22 });
        playSound(700, 'sawtooth', 0.04, 0.02);
    }

    function bossFire() {
        let bx = Math.sin(Date.now()/500) * (canvas.width/4) + (canvas.width/2);
        for(let i=-2; i<=2; i++) enemyBullets.push({ x: bx, y: 240, vx: i*3, vy: 7, r: 8, c: '#ff0055' });
        playSound(100, 'square', 0.2, 0.1);
    }

    function enemyFire() {
        enemies.forEach(e => {
            if(Math.random() < 0.3) {
                enemyBullets.push({ x: e.x + e.w/2, y: e.y + e.h, vx: 0, vy: 6, r: 5, c: '#ff3e3e' });
            }
        });
    }

    function spawn() {
        enemies.push({ x: Math.random()*(canvas.width-60), y: -70, w: 60, h: 60, s: 2.5 + (stage * 0.7), hp: stage });
    }

    function explode(x, y, color) {
        for(let i=0; i<15; i++) particles.push({ x: x, y: y, vx: (Math.random()-0.5)*12, vy: (Math.random()-0.5)*12, l: 30, c: color });
    }

    function damagePlayer() {
        health -= 15; updateHUD();
        document.getElementById('damageOverlay').style.display = 'block';
        canvas.classList.add('shake');
        playSound(100, 'sawtooth', 0.1, 0.15);
        if(navigator.vibrate) navigator.vibrate(80);
        setTimeout(() => {
            document.getElementById('damageOverlay').style.display = 'none';
            canvas.classList.remove('shake');
        }, 200);
    }

    function loop() {
        if(!gameActive) return;
        if(!isPaused) {
            ctx.fillStyle = "#000"; ctx.fillRect(0,0, canvas.width, canvas.height);

            // 1. Parallax Stars
            stars.forEach(st => {
                st.y += st.s; if(st.y > canvas.height) st.y = -5;
                ctx.fillStyle = `rgba(255,255,255,${st.o})`; ctx.fillRect(st.x, st.y, st.s/2, st.s/2);
            });

            // 2. Smooth Interpolation
            player.x += (player.tx - player.x) * 0.2;
            player.y += (player.ty - player.y) * 0.2;

            // 3. Particles
            particles.forEach((p, i) => {
                p.x += p.vx; p.y += p.vy; p.l--;
                ctx.fillStyle = p.c; ctx.fillRect(p.x, p.y, 3, 3);
                if(p.l <= 0) particles.splice(i, 1);
            });

            // Boss Trigger
            if(score >= 1000 && stage === 1 && !dragonActive) {
                dragonActive = true; document.getElementById('bossHealthWrap').style.display = 'block';
            }

            // 4. Bullets (Yellow Glow)
            bullets.forEach((b, i) => {
                b.y -= 15;
                ctx.shadowBlur = 10; ctx.shadowColor = "var(--gold)";
                ctx.fillStyle = "var(--gold)"; ctx.fillRect(b.x, b.y, b.w, b.h);
                ctx.shadowBlur = 0;
                if(b.y < -30) bullets.splice(i, 1);
            });

            // 5. Enemy Projectiles (Red Glow & Damage Logic)
            enemyBullets.forEach((eb, i) => {
                eb.x += eb.vx || 0; eb.y += eb.vy || 8;
                ctx.shadowBlur = 10; ctx.shadowColor = eb.c;
                ctx.fillStyle = eb.c; ctx.beginPath(); ctx.arc(eb.x, eb.y, eb.r, 0, Math.PI*2); ctx.fill();
                ctx.shadowBlur = 0;
                
                if(player.alive && eb.x > player.x && eb.x < player.x+player.w && eb.y > player.y && eb.y < player.y+player.h) {
                    damagePlayer(); enemyBullets.splice(i, 1);
                }
                if(eb.y > canvas.height) enemyBullets.splice(i, 1);
            });

            // 6. Enemies
            enemies.forEach((e, i) => {
                e.y += e.s; ctx.drawImage(enemyImg, e.x, e.y, e.w, e.h);
                bullets.forEach((b, bi) => {
                    if(b.x < e.x+e.w && b.x+b.w > e.x && b.y < e.y+e.h && b.y+b.h > e.y) {
                        e.hp--; bullets.splice(bi, 1);
                        if(e.hp <= 0) {
                            explode(e.x+30, e.y+30, "orange"); enemies.splice(i, 1); score += 50; updateHUD();
                            playSound(200, 'square', 0.08, 0.06);
                        }
                    }
                });
                if(e.y > canvas.height) enemies.splice(i, 1);
            });

            // 7. Dragon Boss
            if(dragonActive) {
                let bx = Math.sin(Date.now()/500) * (canvas.width/4) + (canvas.width/2 - 75);
                ctx.drawImage(bossImg, bx, 110, 150, 150);
                bullets.forEach((b, bi) => {
                    if(b.x > bx && b.x < bx+150 && b.y < 260) {
                        dragonHP -= 4; bullets.splice(bi, 1);
                        document.getElementById('bossFill').style.width = (dragonHP/10) + "%";
                        if(dragonHP <= 0) {
                            explode(bx+75, 185, "white"); dragonActive = false;
                            document.getElementById('bossHealthWrap').style.display = 'none';
                            stage++; score += 5000; updateHUD();
                        }
                    }
                });
            }

            // 8. Player Jet
            if(player.alive) {
                ctx.shadowBlur = 20; ctx.shadowColor = "var(--cyan)";
                ctx.drawImage(shipImg, player.x, player.y, player.w, player.h);
                ctx.shadowBlur = 0;
            }

            if(health <= 0 && player.alive) { 
                player.alive = false; explode(player.x+35, player.y+35, "cyan");
                setTimeout(() => { alert("MISSION FAILED: SHIP BLASTED!"); location.reload(); }, 1000);
            }
        }
        requestAnimationFrame(loop);
    }

    function updateHUD() {
        document.getElementById('s').innerText = score;
        document.getElementById('h').innerText = health;
    }
</script>
</body>
</html>
