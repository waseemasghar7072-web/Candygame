<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Candy Crush Pro - Challenge Mode</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap');
        
        :root {
            --bg: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            --glass: rgba(255, 255, 255, 0.15);
        }

        body {
            margin: 0; padding: 0; font-family: 'Fredoka One', cursive;
            background: var(--bg); min-height: 100vh;
            display: flex; flex-direction: column; align-items: center;
            color: white; overflow: hidden; touch-action: manipulation;
        }

        /* Screen Shake Effect */
        .shake { animation: shake 0.3s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake { 10%, 90% {transform: translate3d(-1px, 0, 0);} 20%, 80% {transform: translate3d(2px, 0, 0);} 30%, 50%, 70% {transform: translate3d(-4px, 0, 0);} 40%, 60% {transform: translate3d(4px, 0, 0);} }

        .header { 
            display: flex; gap: 15px; margin-top: 15px; 
            background: var(--glass); backdrop-filter: blur(10px);
            padding: 10px 20px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.3);
        }

        .info-card { text-align: center; min-width: 80px; }
        .info-card label { font-size: 12px; display: block; opacity: 0.8; }
        .info-card span { font-size: 20px; color: #ffd700; }

        .grid-container {
            background: rgba(0,0,0,0.4); padding: 10px; border-radius: 20px;
            border: 4px solid #fff; margin: 15px; box-shadow: 0 15px 40px rgba(0,0,0,0.5);
        }

        .grid { display: grid; grid-template-columns: repeat(8, 42px); grid-template-rows: repeat(8, 42px); gap: 4px; }

        .grid div {
            width: 42px; height: 42px; display: flex; align-items: center; justify-content: center;
            font-size: 32px; cursor: pointer; transition: 0.2s;
            text-shadow: 0 3px 0px #888, 0 5px 10px rgba(0,0,0,0.4);
        }

        .grid div.selected { transform: scale(1.2); background: rgba(255,255,255,0.2); border-radius: 8px; }

        .pop { animation: popOut 0.4s forwards; }
        @keyframes popOut { 0% {transform: scale(1);} 50% {transform: scale(1.6); filter: hue-rotate(180deg);} 100% {transform: scale(0); opacity: 0;} }

        /* Game Over Overlay */
        #gameOver {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); display: none; flex-direction: column;
            align-items: center; justify-content: center; z-index: 100;
        }

        .btn-restart {
            background: #ffd700; color: #000; border: none; padding: 15px 40px;
            font-size: 24px; font-family: 'Fredoka One'; border-radius: 30px; cursor: pointer;
        }
    </style>
</head>
<body id="mainBody">

<div class="header">
    <div class="info-card"><label>TIME</label><span id="timer">60</span>s</div>
    <div class="info-card"><label>SCORE</label><span id="score">0</span></div>
    <div class="info-card"><label>LVL</label><span id="level">1</span></div>
</div>

<div class="grid-container">
    <div class="grid" id="gameGrid"></div>
</div>

<div id="gameOver">
    <h1>GAME OVER! üç¨</h1>
    <p>‡§Ü‡§™‡§ï‡§æ ‡§∏‡•ç‡§ï‡•ã‡§∞: <span id="finalScore">0</span></p>
    <button class="btn-restart" onclick="location.reload()">‡§¶‡•ã‡§¨‡§æ‡§∞‡§æ ‡§ñ‡•á‡§≤‡•á‡§Ç</button>
</div>

<script>
    const grid = document.getElementById('gameGrid');
    const scoreText = document.getElementById('score');
    const timerText = document.getElementById('timer');
    const mainBody = document.getElementById('mainBody');
    let squares = [];
    let score = 0;
    let timeLeft = 60;
    let firstSelected = null;
    const fruits = ['üçé', 'üçá', 'üçä', 'üçì', 'üçç', 'üçí'];
    const BOMB = 'üí£';

    function init() {
        for (let i = 0; i < 64; i++) {
            const square = document.createElement('div');
            square.dataset.id = i;
            square.innerHTML = fruits[Math.floor(Math.random() * 4)];
            square.onclick = () => handleTap(i);
            grid.appendChild(square);
            squares.push(square);
        }
        startTimer();
        setInterval(checkMatches, 600);
    }

    function startTimer() {
        const countdown = setInterval(() => {
            timeLeft--;
            timerText.innerText = timeLeft;
            if (timeLeft <= 0) {
                clearInterval(countdown);
                showGameOver();
            }
        }, 1000);
    }

    function handleTap(id) {
        if (squares[id].innerHTML === BOMB) {
            triggerBomb(id);
            return;
        }

        if (firstSelected === null) {
            firstSelected = id;
            squares[id].classList.add('selected');
        } else {
            if (isAdjacent(firstSelected, id)) {
                swap(firstSelected, id);
                setTimeout(checkMatches, 300);
            }
            squares[firstSelected].classList.remove('selected');
            firstSelected = null;
        }
    }

    function isAdjacent(id1, id2) {
        const x1 = id1 % 8, y1 = Math.floor(id1 / 8);
        const x2 = id2 % 8, y2 = Math.floor(id2 / 8);
        return (Math.abs(x1 - x2) + Math.abs(y1 - y2)) === 1;
    }

    function swap(id1, id2) {
        let temp = squares[id1].innerHTML;
        squares[id1].innerHTML = squares[id2].innerHTML;
        squares[id2].innerHTML = temp;
    }

    function checkMatches() {
        let matchIds = new Set();
        
        // Horizontal
        for (let i = 0; i < 64; i++) {
            if (i % 8 < 6) {
                if (squares[i].innerHTML !== '' && squares[i].innerHTML !== BOMB &&
                    squares[i].innerHTML === squares[i+1].innerHTML && 
                    squares[i].innerHTML === squares[i+2].innerHTML) {
                    matchIds.add(i); matchIds.add(i+1); matchIds.add(i+2);
                }
            }
        }
        
        // Vertical
        for (let i = 0; i < 48; i++) {
            if (squares[i].innerHTML !== '' && squares[i].innerHTML !== BOMB &&
                squares[i].innerHTML === squares[i+8].innerHTML && 
                squares[i].innerHTML === squares[i+16].innerHTML) {
                matchIds.add(i); matchIds.add(i+8); matchIds.add(i+16);
            }
        }

        if (matchIds.size > 0) {
            // If match is big (4 or more), create a Bomb
            if (matchIds.size >= 4) {
                const firstId = Array.from(matchIds)[0];
                setTimeout(() => { squares[firstId].innerHTML = BOMB; }, 500);
            }
            
            matchIds.forEach(id => squares[id].classList.add('pop'));
            score += matchIds.size;
            scoreText.innerText = score;
            setTimeout(dropItems, 400);
        }
    }

    function triggerBomb(id) {
        mainBody.classList.add('shake');
        setTimeout(() => mainBody.classList.remove('shake'), 300);
        
        const x = id % 8;
        const y = Math.floor(id / 8);
        
        for (let i = -1; i <= 1; i++) {
            for (let j = -1; j <= 1; j++) {
                const nx = x + i;
                const ny = y + j;
                if (nx >= 0 && nx < 8 && ny >= 0 && ny < 8) {
                    const targetId = ny * 8 + nx;
                    squares[targetId].classList.add('pop');
                }
            }
        }
        score += 20;
        scoreText.innerText = score;
        setTimeout(dropItems, 400);
    }

    function dropItems() {
        for (let i = 0; i < 64; i++) {
            if (squares[i].classList.contains('pop')) {
                squares[i].innerHTML = '';
                squares[i].classList.remove('pop');
            }
        }
        // Gravity logic
        for (let i = 55; i >= 0; i--) {
            if (squares[i + 8].innerHTML === '') {
                squares[i+8].innerHTML = squares[i].innerHTML;
                squares[i].innerHTML = '';
            }
        }
        // Refill top
        for (let i = 0; i < 8; i++) {
            if (squares[i].innerHTML === '') {
                squares[i].innerHTML = fruits[Math.floor(Math.random() * 5)];
            }
        }
    }

    function showGameOver() {
        document.getElementById('gameOver').style.display = 'flex';
        document.getElementById('finalScore').innerText = score;
    }

    init();
</script>
</body>
</html>
